<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Designing a Mobile-Enabling API | Day of DotNetNuke, Charlotte, June 2, 2012 | by Brian Dukes @BrianDukes</title>
    
    <meta name="description" content="Use the new DotNetNuke Service Framework to enable your modules and other extensions to power mobile applications and other new and unique workflows.  While it's always been possible to have various sorts of web services alongside your module, the Service Framework provides a common pattern to enable smart authentication and a clean development model.  This presentation will demonstrate what it looks like to use the Service Framework to develop an API that exposes rich functionality to a wide variety of potential clients, including native mobile applications." />
    <meta name="author" content="Brian Dukes" />

    <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />
    <link href="css/impress-demo.css" rel="stylesheet" />
    <link href="css/shCoreRDark.css" rel="stylesheet" />
    
    <link rel="shortcut icon" href="favicon.png" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />
</head>
<body class="impress-not-supported">
<div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
</div>
<div id="impress">
    <div class="step slide" data-x="0">
        <hgroup>
            <h1>Designing a Mobile-Enabling API</h1>
            <h2>Brian Dukes, Engage Software</h2>
            <h3>Charlotte Day of DotNetNuke 2012</h3>
        </hgroup>
    </div>
    <div class="step slide" data-x="1000">
        <q>What does it <strong>look like</strong> to use the Services Framework?</q>
    </div>
    <div id="technology-overview" class="step slide" data-x="2000">
        <h3>Technology Overview</h3>
        <ul>
            <li>
                Based on <strong>ASP.NET MVC 2</strong>
                <ul><li>Probably <strong>ASP.NET Web API</strong> in the near future</li></ul>
            </li>
            <li>
                Implement <strong>controllers</strong> to process requests
            </li>
            <li>
                Register <strong>routes</strong> to direct requests to controller <strong>actions</strong>
            </li>
            <li>
                Very easy to provide <strong><abbr title="JavaScript Object Notation">JSON</abbr></strong> responses
                <ul><li><strong>Web API</strong> would provide more serialization options</li></ul>
            </li>
        </ul>
    </div>
    <div id="controllers" class="step slide" data-x="3000">
        <h3>Controllers</h3>
        <ul>
            <li>
                Inherit from <code>DnnController</code>
            </li>
            <li>
                Class name must end with <code>Controller</code>
            </li>
            <li>
                All <code>public</code> methods are actions
                <ul><li>Opt out with <code>NonActionAttribute</code></li></ul>
            </li>
            <li>
                Actions typically return <code>ActionResult</code>
            </li>
        </ul>
    </div>
    <div id="controller-example" class="step slide code-slide" data-x="4100">
        <h3>Controller Example</h3>
        <pre class="brush: csharp">
        namespace Example.Dnn.Services {
            using System.Web.Mvc;
            using DotNetNuke.Web.Services;

            public class ExampleController : DnnController {
                public ActionResult Hello() {
                    return Json(new { 
                        number = 1, 
                        text = "Hi!",
                    });
                }
            }
        }
        </pre>
    </div>
    <div id="routes" class="step slide" data-x="5200">
        <h3>Routes</h3>
        <ul>
            <li>
                Implement <code>IServiceRouteMapper</code> interface
                <ul><li><code>void RegisterRoutes(IMapRoute)</code></li></ul>
            </li>
            <li>
                Call <code>MapRoute</code> method on <code>IMapRoute</code> argument
            </li>
            <li>
                Services route to <code>/DesktopModules/Module/API/[route]</code>
            </li>
            <li>
                Define <strong>placeholders</strong> or <strong>defaults</strong> for the controller &amp; action
            </li>
            <li>
                Can define route <strong>constraints</strong>, also
                <ul>
                  <li>Regular expression</li>
                  <li>Implement <code>IRouteConstraint</code>'s <code>Match</code> method</li>
                </ul>
            </li>
        </ul>
    </div>
    <div id="route-example" class="step slide code-slide" data-x="6300">
        <h3>Route Example</h3>
        <pre class="brush: csharp">
        /*/DesktopModules/Example/S/API/Example.ashx/Hello*/
        namespace Example.Dnn.Services {
            using DotNetNuke.Web.Services;

            public class Mapperator : IServiceRouteMapper {
                public void RegisterRoutes(IMapRoute mapper) {
                    mapper.MapRoute(
                        moduleFolderName: "Example/S", 
                        url: "{controller}.ashx/{action}", 
                        namespaces: new[] { 
                            "Example.Dnn.Services",
                        });
                }
            }
        }
        </pre>
    </div>
    <div id="route-example-with-defaults-and-constraint" class="step slide code-slide" data-x="7500">
        <h3>Route Example with Defaults and Constraint</h3>
        <pre class="brush: csharp">
        /*/DesktopModules/Example/Services/API/Ex/Find/123*/
        mapper.MapRoute(
            moduleFolderName: "Example/Services",
            url: "Ex/{action}/{id}",
            defaults: new {
                controller = "Example",
                action = "Index", 
                id = string.Empty,
            },
            constraints: new { id = @"\d+", },
            namespaces: new[] {
                "Example.Dnn.Services",
            });
        </pre>
    </div>
    <div id="authentication" class="step slide" data-x="8600">
        <h3>Authentication</h3>
        <ul>
            <li>
                <strong>Basic</strong> access authentication
                <ul>
                    <li>Requires <abbr title="Secure HyperText Transport Protocol">HTTPS</abbr>/<abbr title="Secure Sockets Layer">SSL</abbr> for security</li>
                    <li>Passes credentials on each request</li>
                </ul>
            </li>
            <li>
                <strong>Digest</strong> access authentication
                <ul>
                    <li>Uses MD5 for security</li>
                    <li>Windows Phone 7 does not natively support digest</li>
                </ul>
            </li>
            <li>
                More to come
            </li>
            <li>
                Anti-Forgery Token
            </li>
        </ul>
    </div>
    <div id="authorization" class="step slide" data-x="9600">
        <h3>Authorization</h3>
        <ul>
            <li>
                <code>DnnAuthorizeAttribute</code>
                <ul>
                    <li>Disallows anonymous access by default</li>
                    <li>Can provide static list of role names</li>
                    <li>Can limit to host access only</li>
                </ul>
            </li>
            <li>
                <code>AcceptVerbsAttribute</code>
                <ul>
                    <li>Provide bitwise combination of allowed verbs</li>
                    <li>Can also use <code>HttpPost</code>, <code>HttpGet</code>, etc.</li>
                </ul>
            </li>
        </ul>
    </div>
    <div id="authorization-2" class="step slide" data-x="10600">
        <h3>Authorization</h3>
        <ul>
            <li>
                <code>SupportedModulesAttribute</code>
                <ul>
                    <li>Comma-separated <strong>desktop module</strong> names</li>
                    <li>
                        Requires <code>ModuleId</code> and <code>TabId</code> in request
                        <ul>
                            <li>Can be header, query-string, form value or cookie</li>
                            <li><code>beforeSend: sf.setModuleHeaders</code></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                <code>DnnModuleAuthorizeAttribute</code>
                <ul>
                    <li>Define <strong>access level</strong> and/or <strong>permission key</strong></li>
                    <li>Defaults to <strong>Host</strong> access level</li>
                    <li>Requires <code>ModuleId</code> and <code>TabId</code> in request</li>
                </ul>
            </li>
        </ul>
    </div>
    <div id="dnn-context" class="step slide" data-x="11600">
        <h3><abbr title="DotNetNuke">DNN</abbr> Context</h3>
        <ul>
            <li><code>UserInfo</code> (and authentication)</li>
            <li><code>ActiveModule</code></li>
            <li>
                <code>PortalSettings</code>
                <ul>
                    <li><code>ActiveTab</code></li>
                    <li><code>HomeDirectoryMapPath</code></li>
                    <li><code>AdministratorId</code></li>
                    <li><code>AdministratorRoleName</code></li>
                    <li><code>CultureCode</code></li>
                    <li><code>PortalAlias</code></li>
                    <li>etc.</li>
                </ul>
            </li>
        </ul>
    </div>
    <div id="usage-request-scripts" class="step slide code-slide" data-x="12700">
        <h3>Usage &#x2013; Request Scripts</h3>
        <pre class="brush: csharp">
        using DotNetNuke.Framework;

        public class MyModuleControl : ModuleView&lt;MyViewModel> {
            protected override void OnInit(EventArgs e) {
                base.OnInit(e);

                var sf = ServicesFramework.Instance;
                sf.RequestAjaxScriptSupport();
                sf.RequestAjaxAntiForgerySupport();
            }
        }
        </pre>
    </div>
    <div id="usage-ajax-request" class="step slide code-slide" data-x="13900">
        <h3>Usage &#x2013; Ajax Request</h3>
        <pre class="brush: js">
        var sf = $.ServicesFramework(&lt;%:ModuleContext.ModuleId%>);
        $.ajax({
            type: 'POST',
            url: sf.getServiceRoot('Example/S') + 'Example/Hello',
            beforeSend: sf.setModuleHeaders,
            data: sf.getAntiForgeryProperty({ /*...*/ })
        }).done(function (data) { /*...*/ })
          .fail(function (xhr, status) { /*...*/ });
        </pre>
    </div>
</div>

<div class="hint">
    <p>Use a spacebar or arrow keys to navigate</p>
</div>
<script src="js/impress.js"></script>
<script src="js/shCore.js"></script>
<script src="js/shBrushCSharp.js"></script>
<script src="js/shBrushJScript.js"></script>
<script>SyntaxHighlighter.all();</script>
</body>
</html>